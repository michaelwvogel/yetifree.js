!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(){CanvasRenderingContext2D.prototype.storeLoadedImage=function(key,image){this.images||(this.images={}),this.images[key]=image},CanvasRenderingContext2D.prototype.getLoadedImage=function(key){return this.images[key]?this.images[key]:void 0},CanvasRenderingContext2D.prototype.followSprite=function(sprite){this.centralSprite=sprite},CanvasRenderingContext2D.prototype.getCentralPosition=function(){return{map:this.centralSprite.mapPosition,canvas:[Math.round(.5*this.canvas.width),Math.round(.5*this.canvas.height),0]}},CanvasRenderingContext2D.prototype.mapPositionToCanvasPosition=function(position){var central=this.getCentralPosition(),centralMapPosition=central.map,centralCanvasPosition=central.canvas,mapDifferenceX=centralMapPosition[0]-position[0],mapDifferenceY=centralMapPosition[1]-position[1];return[centralCanvasPosition[0]-mapDifferenceX,centralCanvasPosition[1]-mapDifferenceY]},CanvasRenderingContext2D.prototype.canvasPositionToMapPosition=function(position){var central=this.getCentralPosition(),centralMapPosition=central.map,centralCanvasPosition=central.canvas,mapDifferenceX=centralCanvasPosition[0]-position[0],mapDifferenceY=centralCanvasPosition[1]-position[1];return[centralMapPosition[0]-mapDifferenceX,centralMapPosition[1]-mapDifferenceY]},CanvasRenderingContext2D.prototype.getCentreOfViewport=function(){return(this.canvas.width/2).floor()},CanvasRenderingContext2D.prototype.getMiddleOfViewport=function(){return(this.canvas.height/2).floor()},CanvasRenderingContext2D.prototype.getBelowViewport=function(){return this.canvas.height.floor()},CanvasRenderingContext2D.prototype.getMapBelowViewport=function(){var below=this.getBelowViewport();return this.canvasPositionToMapPosition([0,below])[1]},CanvasRenderingContext2D.prototype.getRandomlyInTheCentreOfCanvas=function(buffer){var min=0,max=this.canvas.width;return buffer&&(min-=buffer,max+=buffer),Number.random(min,max)},CanvasRenderingContext2D.prototype.getRandomlyInTheCentreOfMap=function(buffer){var random=this.getRandomlyInTheCentreOfCanvas(buffer);return this.canvasPositionToMapPosition([random,0])[0]},CanvasRenderingContext2D.prototype.getRandomMapPositionBelowViewport=function(){var xCanvas=this.getRandomlyInTheCentreOfCanvas(),yCanvas=this.getBelowViewport();return this.canvasPositionToMapPosition([xCanvas,yCanvas])},CanvasRenderingContext2D.prototype.getRandomMapPositionAboveViewport=function(){var xCanvas=this.getRandomlyInTheCentreOfCanvas(),yCanvas=this.getAboveViewport();return this.canvasPositionToMapPosition([xCanvas,yCanvas])},CanvasRenderingContext2D.prototype.getTopOfViewport=function(){return this.canvasPositionToMapPosition([0,0])[1]},CanvasRenderingContext2D.prototype.getAboveViewport=function(){return 0-(this.canvas.height/4).floor()}},{}],2:[function(){Function.prototype.method=function(name,func){return this.prototype[name]=func,this},Object.method("superior",function(name){var that=this,method=that[name];return function(){return method.apply(that,arguments)}})},{}],3:[function(require,module){var SpriteArray=require("./spriteArray"),EventedLoop=require("eventedloop");!function(global){function Game(mainCanvas,player){var staticObjects=new SpriteArray,movingObjects=new SpriteArray,uiElements=new SpriteArray,dContext=mainCanvas.getContext("2d"),mouseX=dContext.getCentreOfViewport(),mouseY=0,paused=!1,that=this,beforeCycleCallbacks=[],afterCycleCallbacks=[],gameLoop=new EventedLoop;this.addStaticObject=function(sprite){staticObjects.push(sprite)},this.addStaticObjects=function(sprites){sprites.forEach(this.addStaticObject.bind(this))},this.addMovingObject=function(movingObject,movingObjectType){movingObjectType&&staticObjects.onPush(function(obj){obj.data&&obj.data.hitBehaviour[movingObjectType]&&obj.onHitting(movingObject,obj.data.hitBehaviour[movingObjectType])},!0),movingObjects.push(movingObject)},this.addUIElement=function(element){uiElements.push(element)},this.beforeCycle=function(callback){beforeCycleCallbacks.push(callback)},this.afterCycle=function(callback){afterCycleCallbacks.push(callback)},this.setMouseX=function(x){mouseX=x},this.setMouseY=function(y){mouseY=y},player.setMapPosition(0,0),player.setMapPositionTarget(0,-10),dContext.followSprite(player);var intervalNum=0;this.cycle=function(){beforeCycleCallbacks.each(function(c){c()});var mouseMapPosition=dContext.canvasPositionToMapPosition([mouseX,mouseY]);player.isJumping||player.setMapPositionTarget(mouseMapPosition[0],mouseMapPosition[1]),intervalNum++,player.cycle(),movingObjects.each(function(movingObject){movingObject.cycle(dContext)}),staticObjects.cull(),staticObjects.each(function(staticObject){staticObject.cycle&&staticObject.cycle()}),uiElements.each(function(uiElement){uiElement.cycle&&uiElement.cycle()}),afterCycleCallbacks.each(function(c){c()})},that.draw=function(){mainCanvas.width=mainCanvas.width,player.draw(dContext),player.cycle(),movingObjects.each(function(movingObject){movingObject.draw(dContext)}),staticObjects.each(function(staticObject){staticObject.draw&&staticObject.draw(dContext,"main")}),uiElements.each(function(uiElement){uiElement.draw&&uiElement.draw(dContext,"main")})},this.start=function(){gameLoop.start()},this.pause=function(){paused=!0,gameLoop.stop()},this.isPaused=function(){return paused},this.reset=function(){paused=!1,staticObjects=new SpriteArray,movingObjects=new SpriteArray,mouseX=dContext.getCentreOfViewport(),mouseY=0,player.reset(),player.setMapPosition(0,0,0),this.start()}.bind(this),gameLoop.on("20",this.cycle),gameLoop.on("20",this.draw)}global.game=Game}(this),"undefined"!=typeof module&&(module.exports=this.game)},{"./spriteArray":12,eventedloop:16}],4:[function(require,module){!function(global){function guid(){var S4=function(){return Math.floor(65536*Math.random()).toString(16)};return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}global.guid=guid}(this),"undefined"!=typeof module&&(module.exports=this.guid)},{}],5:[function(require,module){function InfoBox(data){var that=this;return that.lines=data.initialLines,that.top=data.position.top,that.right=data.position.right,that.bottom=data.position.bottom,that.left=data.position.left,that.width=data.width,that.height=data.height,that.setLines=function(lines){that.lines=lines},that.draw=function(dContext){dContext.font="11px monospace";var yOffset=0;that.lines.each(function(line){var xPos,yPos,fontSize=+dContext.font.slice(0,2),textWidth=dContext.measureText(line).width,textHeight=1.5*fontSize;that.top?yPos=that.top+yOffset:that.bottom&&(yPos=dContext.canvas.height-that.top-textHeight+yOffset),that.right?xPos=dContext.canvas.width-that.right-textWidth:that.left&&(xPos=that.left),yOffset+=textHeight,dContext.fillText(line,xPos,yPos)})},that}"undefined"!=typeof module&&(module.exports=InfoBox)},{}],6:[function(require,module){function isMobileDevice(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)?!0:!1}module.exports=isMobileDevice},{}],7:[function(require,module){var Sprite=require("./sprite");!function(global){function Monster(data){function startEating(whenDone){eatingStage+=1,that.isEating=!0,that.isMoving=!1,6>eatingStage?setTimeout(function(){startEating(whenDone)},300):(eatingStage=0,that.isEating=!1,that.isMoving=!0,whenDone())}var that=new Sprite(data),super_draw=that.superior("draw"),spriteVersion=1,eatingStage=0,standardSpeed=6;return that.isEating=!1,that.isFull=!1,that.setSpeed(standardSpeed),that.draw=function(dContext){var spritePartToUse=function(){var xDiff=that.movingToward[0]-that.canvasX;return that.isEating?"eating"+eatingStage:(spriteVersion+.1>2?spriteVersion=.1:spriteVersion+=.1,xDiff>=0?"sEast"+Math.ceil(spriteVersion):0>xDiff?"sWest"+Math.ceil(spriteVersion):void 0)};return super_draw(dContext,spritePartToUse())},that.startEating=startEating,that}global.monster=Monster}(this),"undefined"!=typeof module&&(module.exports=this.monster)},{"./sprite":11}],8:[function(){!function(){for(var method,noop=function(){},methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],length=methods.length,console=window.console=window.console||{};length--;)method=methods[length],console[method]||(console[method]=noop)}()},{}],9:[function(require,module){var Sprite=require("./sprite");"undefined"!=typeof navigator?navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate:navigator={vibrate:!1},function(global){function Skier(data){function setNormal(){that.setSpeed(standardSpeed),that.isMoving=!0,that.hasBeenHit=!1,that.isJumping=!1,that.isPerformingTrick=!1,cancelableStateInterval&&clearInterval(cancelableStateInterval),that.setMapPosition(void 0,void 0,0)}function setCrashed(){that.isMoving=!1,that.hasBeenHit=!0,that.isJumping=!1,that.isPerformingTrick=!1,cancelableStateInterval&&clearInterval(cancelableStateInterval),that.setMapPosition(void 0,void 0,0)}function setJumping(){var currentSpeed=that.getSpeed();that.setSpeed(currentSpeed+2),that.setSpeedY(currentSpeed+2),that.isMoving=!0,that.hasBeenHit=!1,that.isJumping=!0,that.setMapPosition(void 0,void 0,1)}function getDiscreteDirection(){if(that.direction)return that.direction<=90?"east":that.direction>90&&that.direction<150?"esEast":that.direction>=150&&that.direction<180?"sEast":180===that.direction?"south":that.direction>180&&that.direction<=210?"sWest":that.direction>210&&that.direction<270?"wsWest":that.direction>=270?"west":"south";var xDiff=that.movingToward[0]-that.mapPosition[0],yDiff=that.movingToward[1]-that.mapPosition[1];return 0>=yDiff?xDiff>0?"east":"west":directions.esEast(xDiff)?"esEast":directions.sEast(xDiff)?"sEast":directions.wsWest(xDiff)?"wsWest":directions.sWest(xDiff)?"sWest":"south"}function setDiscreteDirection(d){discreteDirections[d]&&that.setDirection(discreteDirections[d]),that.isMoving="west"===d||"east"===d?!1:!0}function getBeingEatenSprite(){return"blank"}function getJumpingSprite(){return"jumping"}function getTrickSprite(){return console.log("Trick step is",trickStep),0===trickStep?"jumping":1===trickStep?"somersault1":"somersault2"}function easeSpeedToTargetUsingFactor(sp,targetSpeed,f){return 0===f||1===f?targetSpeed:(targetSpeed>sp&&(sp+=that.getSpeed()*(f/turnEaseCycles)),sp>targetSpeed&&(sp-=that.getSpeed()*(f/turnEaseCycles)),sp)}var cancelableStateTimeout,cancelableStateInterval,discreteDirections={west:270,wsWest:240,sWest:195,south:180,sEast:165,esEast:120,east:90},that=new Sprite(data),sup={draw:that.superior("draw"),cycle:that.superior("cycle"),getSpeedX:that.superior("getSpeedX"),getSpeedY:that.superior("getSpeedY"),hits:that.superior("hits")},directions={esEast:function(xDiff){return xDiff>300},sEast:function(xDiff){return xDiff>75},wsWest:function(xDiff){return-300>xDiff},sWest:function(xDiff){return-75>xDiff}},canSpeedBoost=!0,obstaclesHit=[],pixelsTravelled=0,standardSpeed=5,boostMultiplier=2,turnEaseCycles=70,speedX=0,speedXFactor=0,speedY=0,speedYFactor=1,trickStep=0;return that.isMoving=!0,that.hasBeenHit=!1,that.isJumping=!1,that.isPerformingTrick=!1,that.onHitObstacleCb=function(){},that.setSpeed(standardSpeed),that.reset=function(){obstaclesHit=[],pixelsTravelled=0,that.isMoving=!0,that.hasBeenHit=!1,canSpeedBoost=!0,setNormal()},that.stop=function(){setDiscreteDirection(that.direction>180?"west":"east")},that.turnEast=function(){var discreteDirection=getDiscreteDirection();switch(discreteDirection){case"west":setDiscreteDirection("wsWest");break;case"wsWest":setDiscreteDirection("sWest");break;case"sWest":setDiscreteDirection("south");break;case"south":setDiscreteDirection("sEast");break;case"sEast":setDiscreteDirection("esEast");break;case"esEast":setDiscreteDirection("east");break;default:setDiscreteDirection("south")}},that.turnWest=function(){var discreteDirection=getDiscreteDirection();switch(discreteDirection){case"east":setDiscreteDirection("esEast");break;case"esEast":setDiscreteDirection("sEast");break;case"sEast":setDiscreteDirection("south");break;case"south":setDiscreteDirection("sWest");break;case"sWest":setDiscreteDirection("wsWest");break;case"wsWest":setDiscreteDirection("west");break;default:setDiscreteDirection("south")}},that.stepWest=function(){that.mapPosition[0]-=2*that.speed},that.stepEast=function(){that.mapPosition[0]+=2*that.speed},that.setMapPositionTarget=function(x,y){that.hasBeenHit||(Math.abs(that.mapPosition[0]-x)<=75&&(x=that.mapPosition[0]),that.movingToward=[x,y])},that.startMovingIfPossible=function(){that.hasBeenHit||that.isBeingEaten||(that.isMoving=!0)},that.setTurnEaseCycles=function(c){turnEaseCycles=c},that.getPixelsTravelledDownMountain=function(){return pixelsTravelled},that.resetSpeed=function(){that.setSpeed(standardSpeed)},that.cycle=function(){that.getSpeedX()<=0&&that.getSpeedY()<=0&&(that.isMoving=!1),that.isMoving&&(pixelsTravelled+=that.speed),that.isJumping&&that.setMapPositionTarget(void 0,that.mapPosition[1]+that.getSpeed()),sup.cycle(),that.checkHittableObjects()},that.draw=function(dContext){var spritePartToUse=function(){return that.isBeingEaten?getBeingEatenSprite():that.isJumping?that.isPerformingTrick?getTrickSprite():getJumpingSprite():that.hasBeenHit?"hit":getDiscreteDirection()};return sup.draw(dContext,spritePartToUse())},that.hits=function(obs){return-1!==obstaclesHit.indexOf(obs.id)?!1:obs.occupiesZIndex(that.mapPosition[2])&&sup.hits(obs)?!0:!1},that.speedBoost=function(){var originalSpeed=that.speed;canSpeedBoost&&(canSpeedBoost=!1,that.setSpeed(that.speed*boostMultiplier),setTimeout(function(){that.setSpeed(originalSpeed),setTimeout(function(){canSpeedBoost=!0},1e4)},2e3))},that.attemptTrick=function(){that.isJumping&&(that.isPerformingTrick=!0,cancelableStateInterval=setInterval(function(){trickStep>=2?trickStep=0:trickStep+=1},300))},that.getStandardSpeed=function(){return standardSpeed},that.getSpeedX=function(){return"esEast"===getDiscreteDirection()||"wsWest"===getDiscreteDirection()?(speedXFactor=.5,speedX=easeSpeedToTargetUsingFactor(speedX,that.getSpeed()*speedXFactor,speedXFactor)):"sEast"===getDiscreteDirection()||"sWest"===getDiscreteDirection()?(speedXFactor=.33,speedX=easeSpeedToTargetUsingFactor(speedX,that.getSpeed()*speedXFactor,speedXFactor)):speedX=easeSpeedToTargetUsingFactor(speedX,0,speedXFactor)},that.setSpeedY=function(sy){speedY=sy},that.getSpeedY=function(){return that.isJumping?speedY:"esEast"===getDiscreteDirection()||"wsWest"===getDiscreteDirection()?(speedYFactor=.6,speedY=easeSpeedToTargetUsingFactor(speedY,.6*that.getSpeed(),.6)):"sEast"===getDiscreteDirection()||"sWest"===getDiscreteDirection()?(speedYFactor=.85,speedY=easeSpeedToTargetUsingFactor(speedY,.85*that.getSpeed(),.85)):"east"===getDiscreteDirection()||"west"===getDiscreteDirection()?(speedYFactor=1,speedY=0):speedY=easeSpeedToTargetUsingFactor(speedY,that.getSpeed(),speedYFactor)},that.hasHitObstacle=function(obs){setCrashed(),navigator.vibrate&&navigator.vibrate(500),obstaclesHit.push(obs.id),that.resetSpeed(),that.onHitObstacleCb(obs),cancelableStateTimeout&&clearTimeout(cancelableStateTimeout),cancelableStateTimeout=setTimeout(function(){setNormal()},1500)},that.hasHitJump=function(){setJumping(),cancelableStateTimeout&&clearTimeout(cancelableStateTimeout),cancelableStateTimeout=setTimeout(function(){setNormal()},1e3)},that.isEatenBy=function(monster,whenEaten){that.hasHitObstacle(monster),monster.startEating(whenEaten),obstaclesHit.push(monster.id),that.isMoving=!1,that.isBeingEaten=!0},that.reset=function(){obstaclesHit=[],pixelsTravelled=0,that.isMoving=!0,that.isJumping=!1,that.hasBeenHit=!1,canSpeedBoost=!0},that.setHitObstacleCb=function(fn){that.onHitObstacleCb=fn||function(){}},that}global.skier=Skier}(this),"undefined"!=typeof module&&(module.exports=this.skier)},{"./sprite":11}],10:[function(require,module){var Sprite=require("./sprite");!function(global){function Snowboarder(data){function getDirection(){{var xDiff=that.movingToward[0]-that.mapPosition[0];that.movingToward[1]-that.mapPosition[1]}return directions.sEast(xDiff)?"sEast":"sWest"}var that=new Sprite(data),sup={draw:that.superior("draw"),cycle:that.superior("cycle")},directions={sEast:function(xDiff){return xDiff>0},sWest:function(xDiff){return 0>=xDiff}},standardSpeed=3;return that.setSpeed(standardSpeed),that.cycle=function(dContext){1===Number.random(10)&&(that.setMapPositionTarget(dContext.getRandomlyInTheCentreOfMap()),that.setSpeed(standardSpeed+Number.random(-1,1))),that.setMapPositionTarget(void 0,dContext.getMapBelowViewport()+600),sup.cycle()},that.draw=function(dContext){var spritePartToUse=function(){return getDirection()};return sup.draw(dContext,spritePartToUse())},that}global.snowboarder=Snowboarder}(this),"undefined"!=typeof module&&(module.exports=this.snowboarder)},{"./sprite":11}],11:[function(require,module){!function(global){function Sprite(data){function incrementX(amount){that.canvasX+=amount.toNumber()}function incrementY(amount){that.canvasY+=amount.toNumber()}function getHitBox(forZIndex){return that.data.hitBoxes&&data.hitBoxes[forZIndex]?data.hitBoxes[forZIndex]:void 0}function roundHalf(num){return num=Math.round(2*num)/2}function move(){if(that.isMoving){var currentX=that.mapPosition[0],currentY=that.mapPosition[1];if("undefined"!=typeof that.direction){var d=that.direction-90;0>d&&(d=360+d),currentX+=roundHalf(that.speed*Math.cos(d*(Math.PI/180))),currentY+=roundHalf(that.speed*Math.sin(d*(Math.PI/180)))}else"undefined"!=typeof that.movingToward[0]&&(currentX>that.movingToward[0]?currentX-=Math.min(that.getSpeedX(),Math.abs(currentX-that.movingToward[0])):currentX<that.movingToward[0]&&(currentX+=Math.min(that.getSpeedX(),Math.abs(currentX-that.movingToward[0])))),"undefined"!=typeof that.movingToward[1]&&(currentY>that.movingToward[1]?currentY-=Math.min(that.getSpeedY(),Math.abs(currentY-that.movingToward[1])):currentY<that.movingToward[1]&&(currentY+=Math.min(that.getSpeedY(),Math.abs(currentY-that.movingToward[1]))));that.setMapPosition(currentX,currentY)}}var trackedSpriteToMoveToward,hittableObjects={},zIndexesOccupied=[0],that=this;return that.direction=void 0,that.mapPosition=[0,0,0],that.id=GUID(),that.canvasX=0,that.canvasY=0,that.canvasZ=0,that.height=0,that.speed=0,that.data=data||{parts:{}},that.movingToward=[0,0],that.metresDownTheMountain=0,that.movingWithConviction=!1,that.deleted=!1,that.maxHeight=function(){return Object.values(that.data.parts).map(function(p){return p[3]}).max()}(),that.isMoving=!0,that.data.parts||(that.data.parts={}),data&&data.id&&(that.id=data.id),data&&data.zIndexesOccupied&&(zIndexesOccupied=data.zIndexesOccupied),this.draw=function(dCtx,spriteFrame){var fr=that.data.parts[spriteFrame];that.height=fr[3],that.width=fr[2];var newCanvasPosition=dCtx.mapPositionToCanvasPosition(that.mapPosition);that.setCanvasPosition(newCanvasPosition[0],newCanvasPosition[1]),dCtx.drawImage(dCtx.getLoadedImage(that.data.$imageFile),fr[0],fr[1],fr[2],fr[3],that.canvasX,that.canvasY,fr[2],fr[3])},this.setMapPosition=function(x,y,z){"undefined"==typeof x&&(x=that.mapPosition[0]),"undefined"==typeof y&&(y=that.mapPosition[1]),"undefined"==typeof z?z=that.mapPosition[2]:that.zIndexesOccupied=[z],that.mapPosition=[x,y,z]},this.setCanvasPosition=function(cx,cy){cx&&(!Object.isString(cx)||"+"!==cx.first()&&"-"!==cx.first()?that.canvasX=cx:incrementX(cx)),cy&&(!Object.isString(cy)||"+"!==cy.first()&&"-"!==cy.first()?that.canvasY=cy:incrementY(cy))},this.getCanvasPositionX=function(){return that.canvasX},this.getCanvasPositionY=function(){return that.canvasY},this.getLeftHitBoxEdge=function(zIndex){zIndex=zIndex||0;var lhbe=this.getCanvasPositionX();return getHitBox(zIndex)&&(lhbe+=getHitBox(zIndex)[0]),lhbe},this.getTopHitBoxEdge=function(zIndex){zIndex=zIndex||0;var thbe=this.getCanvasPositionY();return getHitBox(zIndex)&&(thbe+=getHitBox(zIndex)[1]),thbe},this.getRightHitBoxEdge=function(zIndex){return zIndex=zIndex||0,getHitBox(zIndex)?that.canvasX+getHitBox(zIndex)[2]:that.canvasX+that.width},this.getBottomHitBoxEdge=function(zIndex){return zIndex=zIndex||0,getHitBox(zIndex)?that.canvasY+getHitBox(zIndex)[3]:that.canvasY+that.height},this.getPositionInFrontOf=function(){return[that.canvasX,that.canvasY+that.height]},this.setSpeed=function(s){that.speed=s,that.speedX=s,that.speedY=s},this.incrementSpeedBy=function(s){that.speed+=s},that.getSpeed=function(){return that.speed},that.getSpeedX=function(){return that.speed},that.getSpeedY=function(){return that.speed},this.setHeight=function(h){that.height=h},this.setWidth=function(w){that.width=w},this.getMaxHeight=function(){return that.maxHeight},that.getMovingTowardOpposite=function(){if(!that.isMoving)return[0,0];var dx=that.movingToward[0]-that.mapPosition[0],dy=that.movingToward[1]-that.mapPosition[1],oppositeX=Math.abs(dx)>75?0-dx:0,oppositeY=-dy;return[oppositeX,oppositeY]},this.checkHittableObjects=function(){Object.keys(hittableObjects,function(k,objectData){objectData.object.deleted?delete hittableObjects[k]:objectData.object.hits(that)&&objectData.callbacks.each(function(callback){callback(that,objectData.object)})})},this.cycle=function(){that.checkHittableObjects(),trackedSpriteToMoveToward&&that.setMapPositionTarget(trackedSpriteToMoveToward.mapPosition[0],trackedSpriteToMoveToward.mapPosition[1],!0),move()},this.setMapPositionTarget=function(x,y,override){override&&(that.movingWithConviction=!1),that.movingWithConviction||("undefined"==typeof x&&(x=that.movingToward[0]),"undefined"==typeof y&&(y=that.movingToward[1]),that.movingToward=[x,y],that.movingWithConviction=!1)},this.setDirection=function(angle){angle>=360&&(angle=360-angle),that.direction=angle,that.movingToward=void 0},this.resetDirection=function(){that.direction=void 0},this.setMapPositionTargetWithConviction=function(cx,cy){that.setMapPositionTarget(cx,cy),that.movingWithConviction=!0},this.follow=function(sprite){trackedSpriteToMoveToward=sprite},this.stopFollowing=function(){trackedSpriteToMoveToward=!1},this.onHitting=function(objectToHit,callback){return hittableObjects[objectToHit.id]?hittableObjects[objectToHit.id].callbacks.push(callback):void(hittableObjects[objectToHit.id]={object:objectToHit,callbacks:[callback]})},this.deleteOnNextCycle=function(){that.deleted=!0},this.occupiesZIndex=function(z){return zIndexesOccupied.indexOf(z)>=0},this.hits=function(other){var verticalIntersect=!1,horizontalIntersect=!1;return other.getTopHitBoxEdge(that.mapPosition[2])<=that.getBottomHitBoxEdge(that.mapPosition[2])&&other.getBottomHitBoxEdge(that.mapPosition[2])>=that.getBottomHitBoxEdge(that.mapPosition[2])&&(verticalIntersect=!0),other.getTopHitBoxEdge(that.mapPosition[2])<=that.getTopHitBoxEdge(that.mapPosition[2])&&other.getBottomHitBoxEdge(that.mapPosition[2])>=that.getTopHitBoxEdge(that.mapPosition[2])&&(verticalIntersect=!0),other.getLeftHitBoxEdge(that.mapPosition[2])<=that.getRightHitBoxEdge(that.mapPosition[2])&&other.getRightHitBoxEdge(that.mapPosition[2])>=that.getRightHitBoxEdge(that.mapPosition[2])&&(horizontalIntersect=!0),other.getLeftHitBoxEdge(that.mapPosition[2])<=that.getLeftHitBoxEdge(that.mapPosition[2])&&other.getRightHitBoxEdge(that.mapPosition[2])>=that.getLeftHitBoxEdge(that.mapPosition[2])&&(horizontalIntersect=!0),verticalIntersect&&horizontalIntersect},this.isAboveOnCanvas=function(cy){return that.canvasY+that.height<cy},this.isBelowOnCanvas=function(cy){return that.canvasY>cy},that}var GUID=require("./guid");Sprite.createObjects=function(spriteInfoArray,opts){function createOne(spriteInfo){var position=opts.position;if(Number.random(100+opts.rateModifier)<=spriteInfo.dropRate){var sprite=new Sprite(spriteInfo.sprite);return sprite.setSpeed(0),Object.isFunction(position)&&(position=position()),sprite.setMapPosition(position[0],position[1]),spriteInfo.sprite.hitBehaviour&&spriteInfo.sprite.hitBehaviour.skier&&opts.player&&sprite.onHitting(opts.player,spriteInfo.sprite.hitBehaviour.skier),sprite}}Array.isArray(spriteInfoArray)||(spriteInfoArray=[spriteInfoArray]),opts=Object.merge(opts,{rateModifier:0,dropRate:1,position:[0,0]},!1,!1);var objects=spriteInfoArray.map(createOne).remove(void 0);return objects},global.sprite=Sprite}(this),"undefined"!=typeof module&&(module.exports=this.sprite)},{"./guid":4}],12:[function(require,module){!function(global){function SpriteArray(){return this.pushHandlers=[],this}SpriteArray.prototype=Object.create(Array.prototype),SpriteArray.prototype.onPush=function(f,retroactive){this.pushHandlers.push(f),retroactive&&this.each(f)},SpriteArray.prototype.push=function(obj){Array.prototype.push.call(this,obj),this.pushHandlers.each(function(handler){handler(obj)})},SpriteArray.prototype.cull=function(){this.each(function(obj,i){return obj.deleted?delete this[i]:void 0})},global.spriteArray=SpriteArray}(this),"undefined"!=typeof module&&(module.exports=this.spriteArray)},{}],13:[function(require){function loadImages(sources,next){function finish(){loaded+=1,loaded===sources.length&&next(images)}var loaded=0,images={};sources.each(function(src){var im=new Image;im.onload=finish,im.src=src,dContext.storeLoadedImage(src,im)})}function monsterHitsSkierBehaviour(monster,skier){skier.isEatenBy(monster,function(){livesLeft-=1,monster.isFull=!0,monster.isEating=!1,skier.isBeingEaten=!1,monster.setSpeed(skier.getSpeed()),monster.stopFollowing();var randomPositionAbove=dContext.getRandomMapPositionAboveViewport();monster.setMapPositionTarget(randomPositionAbove[0],randomPositionAbove[1])})}function startNeverEndingGame(){function resetGame(){distanceTravelledInMetres=0,livesLeft=5,highScore=localStorage.getItem("highScore"),game.reset(),game.addStaticObject(startSign)}function detectEnd(){game.isPaused()||(highScore=localStorage.setItem("highScore",distanceTravelledInMetres),infoBox.setLines(["Game over!","Hit space to restart"]),game.pause(),game.cycle())}function randomlySpawnNPC(spawnFunction,dropRate){var rateModifier=Math.max(800-mainCanvas.width,0);Number.random(1e3+rateModifier)<=dropRate&&spawnFunction()}function spawnMonster(){var newMonster=new Monster(sprites.monster),randomPosition=dContext.getRandomMapPositionAboveViewport();newMonster.setMapPosition(randomPosition[0],randomPosition[1]),newMonster.follow(player),newMonster.setSpeed(player.getStandardSpeed()),newMonster.onHitting(player,monsterHitsSkierBehaviour),game.addMovingObject(newMonster,"monster")}function spawnBoarder(){var newBoarder=new Snowboarder(sprites.snowboarder),randomPositionAbove=dContext.getRandomMapPositionAboveViewport(),randomPositionBelow=dContext.getRandomMapPositionBelowViewport();newBoarder.setMapPosition(randomPositionAbove[0],randomPositionAbove[1]),newBoarder.setMapPositionTarget(randomPositionBelow[0],randomPositionBelow[1]),newBoarder.onHitting(player,sprites.snowboarder.hitBehaviour.skier),game.addMovingObject(newBoarder)}var player,startSign,infoBox,game;player=new Skier(sprites.skier),player.setMapPosition(0,0),player.setMapPositionTarget(0,-10),loseLifeOnObstacleHit&&player.setHitObstacleCb(function(){livesLeft-=1}),game=new Game(mainCanvas,player),startSign=new Sprite(sprites.signStart),game.addStaticObject(startSign),startSign.setMapPosition(-50,0),dContext.followSprite(player),infoBox=new InfoBox({initialLines:["SkiFree.js",infoBoxControls,"Travelled 0m","High Score: "+highScore,"Skiers left: "+livesLeft,"Created by Dan Hough (@basicallydan)"],position:{top:15,right:10}}),game.beforeCycle(function(){var newObjects=[];player.isMoving&&(newObjects=Sprite.createObjects([{sprite:sprites.smallTree,dropRate:dropRates.smallTree},{sprite:sprites.tallTree,dropRate:dropRates.tallTree},{sprite:sprites.jump,dropRate:dropRates.jump},{sprite:sprites.thickSnow,dropRate:dropRates.thickSnow},{sprite:sprites.rock,dropRate:dropRates.rock}],{rateModifier:Math.max(800-mainCanvas.width,0),position:function(){return dContext.getRandomMapPositionBelowViewport()},player:player})),game.isPaused()||(game.addStaticObjects(newObjects),randomlySpawnNPC(spawnBoarder,.1),distanceTravelledInMetres=parseFloat(player.getPixelsTravelledDownMountain()/pixelsPerMetre).toFixed(1),distanceTravelledInMetres>monsterDistanceThreshold&&randomlySpawnNPC(spawnMonster,.001),infoBox.setLines(["SkiFree.js",infoBoxControls,"Travelled "+distanceTravelledInMetres+"m","Skiers left: "+livesLeft,"High Score: "+highScore,"Created by Dan Hough (@basicallydan)","Current Speed: "+player.getSpeed()]))}),game.afterCycle(function(){0===livesLeft&&detectEnd()}),game.addUIElement(infoBox),$(mainCanvas).mousemove(function(e){game.setMouseX(e.pageX),game.setMouseY(e.pageY),player.resetDirection(),player.startMovingIfPossible()}).bind("click",function(e){game.setMouseX(e.pageX),game.setMouseY(e.pageY),player.resetDirection(),player.startMovingIfPossible()}).focus(),Mousetrap.bind("f",player.speedBoost),Mousetrap.bind("t",player.attemptTrick),Mousetrap.bind(["w","up"],function(){player.stop()}),Mousetrap.bind(["a","left"],function(){270===player.direction?player.stepWest():player.turnWest()}),Mousetrap.bind(["s","down"],function(){player.setDirection(180),player.startMovingIfPossible()}),Mousetrap.bind(["d","right"],function(){90===player.direction?player.stepEast():player.turnEast()}),Mousetrap.bind("m",spawnMonster),Mousetrap.bind("b",spawnBoarder),Mousetrap.bind("space",resetGame);Hammer(mainCanvas).on("press",function(e){e.preventDefault(),game.setMouseX(e.gesture.center.x),game.setMouseY(e.gesture.center.y)}).on("tap",function(e){game.setMouseX(e.gesture.center.x),game.setMouseY(e.gesture.center.y)}).on("pan",function(e){game.setMouseX(e.gesture.center.x),game.setMouseY(e.gesture.center.y),player.resetDirection(),player.startMovingIfPossible()}).on("doubletap",function(){player.speedBoost()});player.isMoving=!1,player.setDirection(270),game.start()}function resizeCanvas(){mainCanvas.width=window.innerWidth,mainCanvas.height=window.innerHeight}require("./lib/canvasRenderingContext2DExtensions"),require("./lib/extenders"),require("./lib/plugins");var Hammer=require("hammerjs"),Mousetrap=require("br-mousetrap"),isMobileDevice=require("./lib/isMobileDevice"),Monster=(require("./lib/spriteArray"),require("./lib/monster")),Sprite=require("./lib/sprite"),Snowboarder=require("./lib/snowboarder"),Skier=require("./lib/skier"),InfoBox=require("./lib/infoBox"),Game=require("./lib/game"),mainCanvas=document.getElementById("skifree-canvas"),dContext=mainCanvas.getContext("2d"),imageSources=["sprite-characters.png","skifree-objects.png"],infoBoxControls="Use the mouse or WASD to control the player";isMobileDevice()&&(infoBoxControls="Tap or drag on the piste to control the player");var sprites=require("./spriteInfo"),pixelsPerMetre=18,distanceTravelledInMetres=0,monsterDistanceThreshold=2e3,livesLeft=5,highScore=0,loseLifeOnObstacleHit=!1,dropRates={smallTree:4,tallTree:2,jump:1,thickSnow:1,rock:1};localStorage.getItem("highScore")&&(highScore=localStorage.getItem("highScore")),window.addEventListener("resize",resizeCanvas,!1),resizeCanvas(),loadImages(imageSources,startNeverEndingGame),this.exports=window},{"./lib/canvasRenderingContext2DExtensions":1,"./lib/extenders":2,"./lib/game":3,"./lib/infoBox":5,"./lib/isMobileDevice":6,"./lib/monster":7,"./lib/plugins":8,"./lib/skier":9,"./lib/snowboarder":10,"./lib/sprite":11,"./lib/spriteArray":12,"./spriteInfo":14,"br-mousetrap":15,
hammerjs:18}],14:[function(require,module){!function(global){function monsterHitsTreeBehaviour(monster){monster.deleteOnNextCycle()}function treeHitsMonsterBehaviour(tree,monster){monster.deleteOnNextCycle()}function treeHitsSkierBehaviour(tree,skier){skier.hasHitObstacle(tree)}function rockHitsSkierBehaviour(rock,skier){skier.hasHitObstacle(rock)}function jumpHitsSkierBehaviour(jump,skier){skier.hasHitJump(jump)}function snowboarderHitsSkierBehaviour(snowboarder,skier){skier.hasHitObstacle(snowboarder)}var sprites={skier:{$imageFile:"sprite-characters.png",parts:{blank:[0,0,0,0],east:[90,112,32,43],esEast:[64,112,26,43],sEast:[64,112,26,43],south:[0,112,32,43],sWest:[0,112,32,43],wsWest:[0,112,32,43],west:[0,112,32,43],hit:[0,78,31,31],jumping:[84,0,32,34],somersault1:[116,0,32,34],somersault2:[148,0,32,34]},hitBoxes:{0:[7,20,27,34]},id:"player",hitBehaviour:{}},smallTree:{$imageFile:"skifree-objects.png",parts:{main:[0,28,30,34]},hitBoxes:{0:[0,18,30,34]},hitBehaviour:{}},tallTree:{$imageFile:"skifree-objects.png",parts:{main:[95,66,32,64]},zIndexesOccupied:[0,1],hitBoxes:{0:[0,54,32,64],1:[0,10,32,54]},hitBehaviour:{}},thickSnow:{$imageFile:"skifree-objects.png",parts:{main:[143,53,43,10]},hitBehaviour:{}},rock:{$imageFile:"skifree-objects.png",parts:{main:[30,52,23,11]},hitBehaviour:{}},monster:{$imageFile:"sprite-characters.png",parts:{sEast1:[49,0,17,34],sEast2:[49,0,17,34],sWest1:[49,37,17,34],sWest2:[49,37,17,34],eating1:[30,408,44,41],eating2:[30,408,44,41],eating3:[30,408,44,41],eating4:[30,408,44,41],eating5:[30,408,44,41]},hitBehaviour:{}},jump:{$imageFile:"skifree-objects.png",parts:{main:[109,55,32,8]},hitBehaviour:{}},signStart:{$imageFile:"skifree-objects.png",parts:{main:[260,103,42,27]},hitBehaviour:{}},snowboarder:{$imageFile:"sprite-characters.png",parts:{sEast:[73,229,20,29],sWest:[95,228,26,30]},hitBehaviour:{}},emptyChairLift:{$imageFile:"skifree-objects.png",parts:{main:[92,136,26,30]},zIndexesOccupied:[1]}};sprites.monster.hitBehaviour.tree=monsterHitsTreeBehaviour,sprites.smallTree.hitBehaviour.monster=treeHitsMonsterBehaviour,sprites.tallTree.hitBehaviour.monster=treeHitsMonsterBehaviour,sprites.smallTree.hitBehaviour.skier=treeHitsSkierBehaviour,sprites.tallTree.hitBehaviour.skier=treeHitsSkierBehaviour,sprites.rock.hitBehaviour.skier=rockHitsSkierBehaviour,sprites.jump.hitBehaviour.skier=jumpHitsSkierBehaviour,sprites.snowboarder.hitBehaviour.skier=snowboarderHitsSkierBehaviour,global.spriteInfo=sprites}(this),"undefined"!=typeof module&&(module.exports=this.spriteInfo)},{}],15:[function(require,module){!function(){function _addEvent(object,type,callback){return object.addEventListener?void object.addEventListener(type,callback,!1):void object.attachEvent("on"+type,callback)}function _characterFromEvent(e){return"keypress"==e.type?String.fromCharCode(e.which):_MAP[e.which]?_MAP[e.which]:_KEYCODE_MAP[e.which]?_KEYCODE_MAP[e.which]:String.fromCharCode(e.which).toLowerCase()}function _modifiersMatch(modifiers1,modifiers2){return modifiers1.sort().join(",")===modifiers2.sort().join(",")}function _resetSequences(do_not_reset){do_not_reset=do_not_reset||{};var key,active_sequences=!1;for(key in _sequence_levels)do_not_reset[key]?active_sequences=!0:_sequence_levels[key]=0;active_sequences||(_inside_sequence=!1)}function _getMatches(character,modifiers,e,remove,combination){var i,callback,matches=[],action=e.type;if(!_callbacks[character])return[];for("keyup"==action&&_isModifier(character)&&(modifiers=[character]),i=0;i<_callbacks[character].length;++i)callback=_callbacks[character][i],callback.seq&&_sequence_levels[callback.seq]!=callback.level||action==callback.action&&("keypress"==action&&!e.metaKey&&!e.ctrlKey||_modifiersMatch(modifiers,callback.modifiers))&&(remove&&callback.combo==combination&&_callbacks[character].splice(i,1),matches.push(callback));return matches}function _eventModifiers(e){var modifiers=[];return e.shiftKey&&modifiers.push("shift"),e.altKey&&modifiers.push("alt"),e.ctrlKey&&modifiers.push("ctrl"),e.metaKey&&modifiers.push("meta"),modifiers}function _fireCallback(callback,e){callback(e)===!1&&(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.returnValue=!1,e.cancelBubble=!0)}function _handleCharacter(character,e){if(!Mousetrap.stopCallback(e,e.target||e.srcElement)){var i,callbacks=_getMatches(character,_eventModifiers(e),e),do_not_reset={},processed_sequence_callback=!1;for(i=0;i<callbacks.length;++i)callbacks[i].seq?(processed_sequence_callback=!0,do_not_reset[callbacks[i].seq]=1,_fireCallback(callbacks[i].callback,e)):processed_sequence_callback||_inside_sequence||_fireCallback(callbacks[i].callback,e);e.type!=_inside_sequence||_isModifier(character)||_resetSequences(do_not_reset)}}function _handleKey(e){e.which="number"==typeof e.which?e.which:e.keyCode;var character=_characterFromEvent(e);if(character)return"keyup"==e.type&&_ignore_next_keyup==character?void(_ignore_next_keyup=!1):void _handleCharacter(character,e)}function _isModifier(key){return"shift"==key||"ctrl"==key||"alt"==key||"meta"==key}function _resetSequenceTimer(){clearTimeout(_reset_timer),_reset_timer=setTimeout(_resetSequences,1e3)}function _getReverseMap(){if(!_REVERSE_MAP){_REVERSE_MAP={};for(var key in _MAP)key>95&&112>key||_MAP.hasOwnProperty(key)&&(_REVERSE_MAP[_MAP[key]]=key)}return _REVERSE_MAP}function _pickBestAction(key,modifiers,action){return action||(action=_getReverseMap()[key]?"keydown":"keypress"),"keypress"==action&&modifiers.length&&(action="keydown"),action}function _bindSequence(combo,keys,callback,action){_sequence_levels[combo]=0,action||(action=_pickBestAction(keys[0],[]));var i,_increaseSequence=function(){_inside_sequence=action,++_sequence_levels[combo],_resetSequenceTimer()},_callbackAndReset=function(e){_fireCallback(callback,e),"keyup"!==action&&(_ignore_next_keyup=_characterFromEvent(e)),setTimeout(_resetSequences,10)};for(i=0;i<keys.length;++i)_bindSingle(keys[i],i<keys.length-1?_increaseSequence:_callbackAndReset,action,combo,i)}function _bindSingle(combination,callback,action,sequence_name,level){combination=combination.replace(/\s+/g," ");var i,key,keys,sequence=combination.split(" "),modifiers=[];if(sequence.length>1)return void _bindSequence(combination,sequence,callback,action);for(keys="+"===combination?["+"]:combination.split("+"),i=0;i<keys.length;++i)key=keys[i],_SPECIAL_ALIASES[key]&&(key=_SPECIAL_ALIASES[key]),action&&"keypress"!=action&&_SHIFT_MAP[key]&&(key=_SHIFT_MAP[key],modifiers.push("shift")),_isModifier(key)&&modifiers.push(key);action=_pickBestAction(key,modifiers,action),_callbacks[key]||(_callbacks[key]=[]),_getMatches(key,modifiers,{type:action},!sequence_name,combination),_callbacks[key][sequence_name?"unshift":"push"]({callback:callback,modifiers:modifiers,action:action,seq:sequence_name,level:level,combo:combination})}function _bindMultiple(combinations,callback,action){for(var i=0;i<combinations.length;++i)_bindSingle(combinations[i],callback,action)}for(var _REVERSE_MAP,_reset_timer,_MAP={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},_KEYCODE_MAP={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},_SHIFT_MAP={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},_SPECIAL_ALIASES={option:"alt",command:"meta","return":"enter",escape:"esc"},_callbacks={},_direct_map={},_sequence_levels={},_ignore_next_keyup=!1,_inside_sequence=!1,i=1;20>i;++i)_MAP[111+i]="f"+i;for(i=0;9>=i;++i)_MAP[i+96]=i;_addEvent(document,"keypress",_handleKey),_addEvent(document,"keydown",_handleKey),_addEvent(document,"keyup",_handleKey);var Mousetrap={bind:function(keys,callback,action){return _bindMultiple(keys instanceof Array?keys:[keys],callback,action),_direct_map[keys+":"+action]=callback,this},unbind:function(keys,action){return _direct_map[keys+":"+action]&&(delete _direct_map[keys+":"+action],this.bind(keys,function(){},action)),this},trigger:function(keys,action){return _direct_map[keys+":"+action](),this},reset:function(){return _callbacks={},_direct_map={},this},stopCallback:function(e,element){return(" "+element.className+" ").indexOf(" mousetrap ")>-1?!1:"INPUT"==element.tagName||"SELECT"==element.tagName||"TEXTAREA"==element.tagName||element.contentEditable&&"true"==element.contentEditable}};window.Mousetrap=Mousetrap,"function"==typeof define&&define.amd&&define("mousetrap",function(){return Mousetrap}),"object"==typeof module&&module.exports&&(module.exports=Mousetrap)}()},{}],16:[function(require,module,exports){(function(global){(function(){function greatestCommonFactor(intervals){for(var sumOfModuli=1,interval=_.min(intervals);0!==sumOfModuli;)sumOfModuli=_.reduce(intervals,function(memo,i){return memo+i%interval},0),0!==sumOfModuli&&(interval-=10);return interval}function parseEvent(e){var intervalGroups=intervalParser.exec(e);if(!intervalGroups)throw new Error("I don't understand that particular interval");var intervalAmount=+intervalGroups[1],intervalType=intervalGroups[2]||"ms";if("s"===intervalType)intervalAmount=1e3*intervalAmount;else if("m"===intervalType)intervalAmount=1e3*intervalAmount*60;else if("h"===intervalType)intervalAmount=1e3*intervalAmount*60*60;else if(intervalType&&"ms"!==intervalType)throw new Error("You can only specify intervals of ms, s, m, or h");if(10>intervalAmount||intervalAmount%10!==0)throw new Error("You can only specify 10s of milliseconds, trust me on this one");return{amount:intervalAmount,type:intervalType}}function EventedLoop(){this.intervalId=void 0,this.intervalLength=void 0,this.intervalsToEmit={},this.currentTick=1,this.maxTicks=0,this.listeningForFocus=!1;var determineIntervalLength=function(){var potentialIntervalLength=greatestCommonFactor(_.keys(this.intervalsToEmit)),changed=!1;return this.intervalLength?potentialIntervalLength!==this.intervalLength&&(this.intervalLength=potentialIntervalLength,changed=!0):this.intervalLength=potentialIntervalLength,this.maxTicks=_.max(_.map(_.keys(this.intervalsToEmit),function(a){return+a}))/this.intervalLength,changed}.bind(this);this.on("newListener",function(e){if("removeListener"!==e&&"newListener"!==e){var intervalInfo=parseEvent(e),intervalAmount=intervalInfo.amount;this.intervalsToEmit[+intervalAmount]=_.union(this.intervalsToEmit[+intervalAmount]||[],[e]),determineIntervalLength()&&this.isStarted()&&this.stop().start()}}),this.on("removeListener",function(e){if(!(EventEmitter.listenerCount(this,e)>0)){var intervalInfo=parseEvent(e),intervalAmount=intervalInfo.amount,removedEvent=this.intervalsToEmit[+intervalAmount].removeOne(e);0===this.intervalsToEmit[+intervalAmount].length&&delete this.intervalsToEmit[+intervalAmount],console.log("Determining interval length after removal of",removedEvent),determineIntervalLength(),determineIntervalLength()&&this.isStarted()&&this.stop().start()}})}var root=this,EventEmitter=require("events").EventEmitter,_=require("underscore"),intervalParser=/([0-9\.]+)(ms|s|m|h)?/,root=global||window;"undefined"==typeof Function.prototype.inherits&&(Function.prototype.inherits=function(parent){this.prototype=Object.create(parent.prototype)}),"undefined"==typeof Array.prototype.removeOne&&(Array.prototype.removeOne=function(){for(var what,ax,a=arguments,L=a.length;L&&this.length;)for(what=a[--L];-1!==(ax=this.indexOf(what));)return this.splice(ax,1)}),EventedLoop.inherits(EventEmitter),EventedLoop.prototype.tick=function(){var milliseconds=this.currentTick*this.intervalLength;return _.each(this.intervalsToEmit,function(events,key){milliseconds%key===0&&_.each(events,function(e){this.emit(e,e,key)}.bind(this))}.bind(this)),this.currentTick+=1,this.currentTick>this.maxTicks&&(this.currentTick=1),this},EventedLoop.prototype.start=function(){if(!this.intervalLength)throw new Error("You haven't specified any interval callbacks. Use EventedLoop.on('500ms', function () { ... }) to do so, and then you can start");return this.intervalId?console.log("No need to start the loop again, it's already started."):(this.intervalId=setInterval(this.tick.bind(this),this.intervalLength),root&&!this.listeningForFocus&&root.addEventListener&&(root.addEventListener("focus",function(){this.start()}.bind(this)),root.addEventListener("blur",function(){this.stop()}.bind(this)),this.listeningForFocus=!0),this)},EventedLoop.prototype.stop=function(){return clearInterval(this.intervalId),this.intervalId=void 0,this},EventedLoop.prototype.isStarted=function(){return!!this.intervalId},EventedLoop.prototype.every=EventedLoop.prototype.on,"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=EventedLoop),exports.EventedLoop=EventedLoop),"undefined"!=typeof window&&(window.EventedLoop=EventedLoop)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{events:19,underscore:17}],17:[function(require,module,exports){(function(){var root=this,previousUnderscore=root._,breaker={},ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,_=function(obj){return obj instanceof _?obj:this instanceof _?void(this._wrapped=obj):new _(obj)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):root._=_,_.VERSION="1.6.0";var each=_.each=_.forEach=function(obj,iterator,context){if(null==obj)return obj;if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,length=obj.length;length>i;i++)if(iterator.call(context,obj[i],i,obj)===breaker)return}else for(var keys=_.keys(obj),i=0,length=keys.length;length>i;i++)if(iterator.call(context,obj[keys[i]],keys[i],obj)===breaker)return;return obj};_.map=_.collect=function(obj,iterator,context){var results=[];return null==obj?results:nativeMap&&obj.map===nativeMap?obj.map(iterator,context):(each(obj,function(value,index,list){results.push(iterator.call(context,value,index,list))}),results)};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(null==obj&&(obj=[]),nativeReduce&&obj.reduce===nativeReduce)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduce(iterator,memo):obj.reduce(iterator);if(each(obj,function(value,index,list){initial?memo=iterator.call(context,memo,value,index,list):(memo=value,initial=!0)}),!initial)throw new TypeError(reduceError);return memo},_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(null==obj&&(obj=[]),nativeReduceRight&&obj.reduceRight===nativeReduceRight)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length}if(each(obj,function(value,index,list){index=keys?keys[--length]:--length,initial?memo=iterator.call(context,memo,obj[index],index,list):(memo=obj[index],initial=!0)}),!initial)throw new TypeError(reduceError);return memo},_.find=_.detect=function(obj,predicate,context){var result;return any(obj,function(value,index,list){return predicate.call(context,value,index,list)?(result=value,!0):void 0}),result},_.filter=_.select=function(obj,predicate,context){var results=[];return null==obj?results:nativeFilter&&obj.filter===nativeFilter?obj.filter(predicate,context):(each(obj,function(value,index,list){predicate.call(context,value,index,list)&&results.push(value)}),results)},_.reject=function(obj,predicate,context){return _.filter(obj,function(value,index,list){return!predicate.call(context,value,index,list)},context)},_.every=_.all=function(obj,predicate,context){predicate||(predicate=_.identity);var result=!0;return null==obj?result:nativeEvery&&obj.every===nativeEvery?obj.every(predicate,context):(each(obj,function(value,index,list){return(result=result&&predicate.call(context,value,index,list))?void 0:breaker}),!!result)};var any=_.some=_.any=function(obj,predicate,context){predicate||(predicate=_.identity);var result=!1;return null==obj?result:nativeSome&&obj.some===nativeSome?obj.some(predicate,context):(each(obj,function(value,index,list){return result||(result=predicate.call(context,value,index,list))?breaker:void 0}),!!result)};_.contains=_.include=function(obj,target){return null==obj?!1:nativeIndexOf&&obj.indexOf===nativeIndexOf?-1!=obj.indexOf(target):any(obj,function(value){return value===target})},_.invoke=function(obj,method){var args=slice.call(arguments,2),isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,_.property(key))},_.where=function(obj,attrs){return _.filter(obj,_.matches(attrs))},_.findWhere=function(obj,attrs){return _.find(obj,_.matches(attrs))},_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.max.apply(Math,obj);var result=-(1/0),lastComputed=-(1/0);return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>lastComputed&&(result=value,lastComputed=computed)}),result},_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.min.apply(Math,obj);var result=1/0,lastComputed=1/0;return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;lastComputed>computed&&(result=value,lastComputed=computed)}),result},_.shuffle=function(obj){var rand,index=0,shuffled=[];return each(obj,function(value){rand=_.random(index++),shuffled[index-1]=shuffled[rand],shuffled[rand]=value}),shuffled},_.sample=function(obj,n,guard){return null==n||guard?(obj.length!==+obj.length&&(obj=_.values(obj)),obj[_.random(obj.length-1)]):_.shuffle(obj).slice(0,Math.max(0,n))};var lookupIterator=function(value){return null==value?_.identity:_.isFunction(value)?value:_.property(value)};_.sortBy=function(obj,iterator,context){return iterator=lookupIterator(iterator),_.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a!==b){if(a>b||void 0===a)return 1;if(b>a||void 0===b)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iterator,context){var result={};return iterator=lookupIterator(iterator),each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value)}),result}};_.groupBy=group(function(result,key,value){_.has(result,key)?result[key].push(value):result[key]=[value]}),_.indexBy=group(function(result,key,value){result[key]=value}),_.countBy=group(function(result,key){_.has(result,key)?result[key]++:result[key]=1}),_.sortedIndex=function(array,obj,iterator,context){iterator=lookupIterator(iterator);for(var value=iterator.call(context,obj),low=0,high=array.length;high>low;){var mid=low+high>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid}return low},_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):obj.length===+obj.length?_.map(obj,_.identity):_.values(obj):[]},_.size=function(obj){return null==obj?0:obj.length===+obj.length?obj.length:_.keys(obj).length},_.first=_.head=_.take=function(array,n,guard){return null==array?void 0:null==n||guard?array[0]:0>n?[]:slice.call(array,0,n)},_.initial=function(array,n,guard){return slice.call(array,0,array.length-(null==n||guard?1:n))},_.last=function(array,n,guard){return null==array?void 0:null==n||guard?array[array.length-1]:slice.call(array,Math.max(array.length-n,0))},_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,null==n||guard?1:n)},_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,output){return shallow&&_.every(input,_.isArray)?concat.apply(output,input):(each(input,function(value){_.isArray(value)||_.isArguments(value)?shallow?push.apply(output,value):flatten(value,shallow,output):output.push(value)}),output)};_.flatten=function(array,shallow){return flatten(array,shallow,[])},_.without=function(array){return _.difference(array,slice.call(arguments,1))},_.partition=function(array,predicate){var pass=[],fail=[];return each(array,function(elem){(predicate(elem)?pass:fail).push(elem)}),[pass,fail]},_.uniq=_.unique=function(array,isSorted,iterator,context){_.isFunction(isSorted)&&(context=iterator,iterator=isSorted,isSorted=!1);var initial=iterator?_.map(array,iterator,context):array,results=[],seen=[];return each(initial,function(value,index){(isSorted?index&&seen[seen.length-1]===value:_.contains(seen,value))||(seen.push(value),results.push(array[index]))}),results},_.union=function(){return _.uniq(_.flatten(arguments,!0))},_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.contains(other,item)})})},_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value)})},_.zip=function(){for(var length=_.max(_.pluck(arguments,"length").concat(0)),results=new Array(length),i=0;length>i;i++)results[i]=_.pluck(arguments,""+i);return results},_.object=function(list,values){if(null==list)return{};for(var result={},i=0,length=list.length;length>i;i++)values?result[list[i]]=values[i]:result[list[i][0]]=list[i][1];return result},_.indexOf=function(array,item,isSorted){if(null==array)return-1;var i=0,length=array.length;if(isSorted){if("number"!=typeof isSorted)return i=_.sortedIndex(array,item),array[i]===item?i:-1;i=0>isSorted?Math.max(0,length+isSorted):isSorted}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;length>i;i++)if(array[i]===item)return i;return-1},_.lastIndexOf=function(array,item,from){if(null==array)return-1;var hasIndex=null!=from;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item);for(var i=hasIndex?from:array.length;i--;)if(array[i]===item)return i;return-1},_.range=function(start,stop,step){arguments.length<=1&&(stop=start||0,start=0),step=arguments[2]||1;for(var length=Math.max(Math.ceil((stop-start)/step),0),idx=0,range=new Array(length);length>idx;)range[idx++]=start,start+=step;return range};var ctor=function(){};_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;return args=slice.call(arguments,2),bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));return Object(result)===result?result:self}},_.partial=function(func){var boundArgs=slice.call(arguments,1);return function(){for(var position=0,args=boundArgs.slice(),i=0,length=args.length;length>i;i++)args[i]===_&&(args[i]=arguments[position++]);for(;position<arguments.length;)args.push(arguments[position++]);return func.apply(this,args)}},_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(0===funcs.length)throw new Error("bindAll must be passed function names");return each(funcs,function(f){obj[f]=_.bind(obj[f],obj)}),obj},_.memoize=function(func,hasher){var memo={};return hasher||(hasher=_.identity),function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)},_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))},_.throttle=function(func,wait,options){var context,args,result,timeout=null,previous=0;options||(options={});var later=function(){previous=options.leading===!1?0:_.now(),timeout=null,result=func.apply(context,args),context=args=null};return function(){var now=_.now();previous||options.leading!==!1||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,0>=remaining?(clearTimeout(timeout),timeout=null,previous=now,result=func.apply(context,args),context=args=null):timeout||options.trailing===!1||(timeout=setTimeout(later,remaining)),result}},_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result,later=function(){var last=_.now()-timestamp;wait>last?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=func.apply(context,args),context=args=null))};return function(){context=this,args=arguments,timestamp=_.now();var callNow=immediate&&!timeout;return timeout||(timeout=setTimeout(later,wait)),callNow&&(result=func.apply(context,args),context=args=null),result}},_.once=function(func){var memo,ran=!1;return function(){return ran?memo:(ran=!0,memo=func.apply(this,arguments),func=null,memo)}},_.wrap=function(func,wrapper){return _.partial(wrapper,func)},_.compose=function(){var funcs=arguments;return function(){for(var args=arguments,i=funcs.length-1;i>=0;i--)args=[funcs[i].apply(this,args)];return args[0]}},_.after=function(times,func){return function(){return--times<1?func.apply(this,arguments):void 0}},_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)_.has(obj,key)&&keys.push(key);return keys},_.values=function(obj){for(var keys=_.keys(obj),length=keys.length,values=new Array(length),i=0;length>i;i++)values[i]=obj[keys[i]];return values},_.pairs=function(obj){for(var keys=_.keys(obj),length=keys.length,pairs=new Array(length),i=0;length>i;i++)pairs[i]=[keys[i],obj[keys[i]]];return pairs},_.invert=function(obj){for(var result={},keys=_.keys(obj),i=0,length=keys.length;length>i;i++)result[obj[keys[i]]]=keys[i];return result},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()},_.extend=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)obj[prop]=source[prop]}),obj},_.pick=function(obj){var copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));return each(keys,function(key){key in obj&&(copy[key]=obj[key])}),copy},_.omit=function(obj){var copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj)_.contains(keys,key)||(copy[key]=obj[key]);return copy},_.defaults=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)void 0===obj[prop]&&(obj[prop]=source[prop])}),obj},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj};var eq=function(a,b,aStack,bStack){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof _&&(a=a._wrapped),b instanceof _&&(b=b._wrapped);var className=toString.call(a);if(className!=toString.call(b))return!1;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var length=aStack.length;length--;)if(aStack[length]==a)return bStack[length]==b;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&"constructor"in a&&"constructor"in b)return!1;aStack.push(a),bStack.push(b);var size=0,result=!0;if("[object Array]"==className){if(size=a.length,result=size==b.length)for(;size--&&(result=eq(a[size],b[size],aStack,bStack)););}else{for(var key in a)if(_.has(a,key)&&(size++,!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack))))break;if(result){for(key in b)if(_.has(b,key)&&!size--)break;result=!size}}return aStack.pop(),bStack.pop(),result};_.isEqual=function(a,b){return eq(a,b,[],[])},_.isEmpty=function(obj){if(null==obj)return!0;if(_.isArray(obj)||_.isString(obj))return 0===obj.length;for(var key in obj)if(_.has(obj,key))return!1;return!0},_.isElement=function(obj){return!(!obj||1!==obj.nodeType)},_.isArray=nativeIsArray||function(obj){return"[object Array]"==toString.call(obj)},_.isObject=function(obj){return obj===Object(obj)},each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}}),_.isArguments(arguments)||(_.isArguments=function(obj){return!(!obj||!_.has(obj,"callee"))}),"function"!=typeof/./&&(_.isFunction=function(obj){return"function"==typeof obj}),_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))},_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj},_.isBoolean=function(obj){return obj===!0||obj===!1||"[object Boolean]"==toString.call(obj)},_.isNull=function(obj){return null===obj},_.isUndefined=function(obj){return void 0===obj},_.has=function(obj,key){return hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.constant=function(value){return function(){return value}},_.property=function(key){return function(obj){return obj[key]}},_.matches=function(attrs){return function(obj){if(obj===attrs)return!0;for(var key in attrs)if(attrs[key]!==obj[key])return!1;return!0}},_.times=function(n,iterator,context){for(var accum=Array(Math.max(0,n)),i=0;n>i;i++)accum[i]=iterator.call(context,i);return accum},_.random=function(min,max){return null==max&&(max=min,min=0),min+Math.floor(Math.random()*(max-min+1))},_.now=Date.now||function(){return(new Date).getTime()};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(method){_[method]=function(string){return null==string?"":(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}}),_.result=function(object,property){if(null==object)return void 0;var value=object[property];return _.isFunction(value)?value.call(object):value},_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];return push.apply(args,arguments),result.call(this,func.apply(_,args))}})};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);

var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g"),index=0,source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){return source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]}),escape&&(source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"),interpolate&&(source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"),evaluate&&(source+="';\n"+evaluate+"\n__p+='"),index=offset+match.length,match}),source+="';\n",settings.variable||(source="with(obj||{}){\n"+source+"}\n"),source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{render=new Function(settings.variable||"obj","_",source)}catch(e){throw e.source=source,e}if(data)return render(data,_);var template=function(data){return render.call(this,data,_)};return template.source="function("+(settings.variable||"obj")+"){\n"+source+"}",template},_.chain=function(obj){return _(obj).chain()};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin(_),each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;return method.apply(obj,arguments),"shift"!=name&&"splice"!=name||0!==obj.length||delete obj[0],result.call(this,obj)}}),each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}}),_.extend(_.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return _})}).call(this)},{}],18:[function(require,module){!function(window,undefined){"use strict";function setup(){Hammer.READY||(Hammer.event.determineEventTypes(),Hammer.utils.each(Hammer.gestures,function(gesture){Hammer.detection.register(gesture)}),Hammer.event.onTouch(Hammer.DOCUMENT,Hammer.EVENT_MOVE,Hammer.detection.detect),Hammer.event.onTouch(Hammer.DOCUMENT,Hammer.EVENT_END,Hammer.detection.detect),Hammer.READY=!0)}var Hammer=function(element,options){return new Hammer.Instance(element,options||{})};Hammer.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Hammer.HAS_POINTEREVENTS=window.navigator.pointerEnabled||window.navigator.msPointerEnabled,Hammer.HAS_TOUCHEVENTS="ontouchstart"in window,Hammer.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android|silk/i,Hammer.NO_MOUSEEVENTS=Hammer.HAS_TOUCHEVENTS&&window.navigator.userAgent.match(Hammer.MOBILE_REGEX),Hammer.EVENT_TYPES={},Hammer.DIRECTION_DOWN="down",Hammer.DIRECTION_LEFT="left",Hammer.DIRECTION_UP="up",Hammer.DIRECTION_RIGHT="right",Hammer.POINTER_MOUSE="mouse",Hammer.POINTER_TOUCH="touch",Hammer.POINTER_PEN="pen",Hammer.UPDATE_VELOCITY_INTERVAL=20,Hammer.EVENT_START="start",Hammer.EVENT_MOVE="move",Hammer.EVENT_END="end",Hammer.DOCUMENT=window.document,Hammer.plugins=Hammer.plugins||{},Hammer.gestures=Hammer.gestures||{},Hammer.READY=!1,Hammer.utils={extend:function(dest,src,merge){for(var key in src)dest[key]!==undefined&&merge||(dest[key]=src[key]);return dest},each:function(obj,iterator,context){var i,length;if("forEach"in obj)obj.forEach(iterator,context);else if(obj.length!==undefined){for(i=0,length=obj.length;length>i;i++)if(iterator.call(context,obj[i],i,obj)===!1)return}else for(i in obj)if(obj.hasOwnProperty(i)&&iterator.call(context,obj[i],i,obj)===!1)return},hasParent:function(node,parent){for(;node;){if(node==parent)return!0;node=node.parentNode}return!1},getCenter:function(touches){var valuesX=[],valuesY=[];return Hammer.utils.each(touches,function(touch){valuesX.push("undefined"!=typeof touch.clientX?touch.clientX:touch.pageX),valuesY.push("undefined"!=typeof touch.clientY?touch.clientY:touch.pageY)}),{pageX:(Math.min.apply(Math,valuesX)+Math.max.apply(Math,valuesX))/2,pageY:(Math.min.apply(Math,valuesY)+Math.max.apply(Math,valuesY))/2}},getVelocity:function(delta_time,delta_x,delta_y){return{x:Math.abs(delta_x/delta_time)||0,y:Math.abs(delta_y/delta_time)||0}},getAngle:function(touch1,touch2){var y=touch2.pageY-touch1.pageY,x=touch2.pageX-touch1.pageX;return 180*Math.atan2(y,x)/Math.PI},getDirection:function(touch1,touch2){var x=Math.abs(touch1.pageX-touch2.pageX),y=Math.abs(touch1.pageY-touch2.pageY);return x>=y?touch1.pageX-touch2.pageX>0?Hammer.DIRECTION_LEFT:Hammer.DIRECTION_RIGHT:touch1.pageY-touch2.pageY>0?Hammer.DIRECTION_UP:Hammer.DIRECTION_DOWN},getDistance:function(touch1,touch2){var x=touch2.pageX-touch1.pageX,y=touch2.pageY-touch1.pageY;return Math.sqrt(x*x+y*y)},getScale:function(start,end){return start.length>=2&&end.length>=2?this.getDistance(end[0],end[1])/this.getDistance(start[0],start[1]):1},getRotation:function(start,end){return start.length>=2&&end.length>=2?this.getAngle(end[1],end[0])-this.getAngle(start[1],start[0]):0},isVertical:function(direction){return direction==Hammer.DIRECTION_UP||direction==Hammer.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(element,css_props){css_props&&element&&element.style&&(Hammer.utils.each(["webkit","khtml","moz","Moz","ms","o",""],function(vendor){Hammer.utils.each(css_props,function(value,prop){vendor&&(prop=vendor+prop.substring(0,1).toUpperCase()+prop.substring(1)),prop in element.style&&(element.style[prop]=value)})}),"none"==css_props.userSelect&&(element.onselectstart=function(){return!1}),"none"==css_props.userDrag&&(element.ondragstart=function(){return!1}))},startDefaultBrowserBehavior:function(element,css_props){css_props&&element&&element.style&&(Hammer.utils.each(["webkit","khtml","moz","Moz","ms","o",""],function(vendor){Hammer.utils.each(css_props,function(value,prop){vendor&&(prop=vendor+prop.substring(0,1).toUpperCase()+prop.substring(1)),prop in element.style&&(element.style[prop]="")})}),"none"==css_props.userSelect&&(element.onselectstart=null),"none"==css_props.userDrag&&(element.ondragstart=null))}},Hammer.Instance=function(element,options){var self=this;return setup(),this.element=element,this.enabled=!0,this.options=Hammer.utils.extend(Hammer.utils.extend({},Hammer.defaults),options||{}),this.options.stop_browser_behavior&&Hammer.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),this._eventStartHandler=Hammer.event.onTouch(element,Hammer.EVENT_START,function(ev){self.enabled&&Hammer.detection.startDetect(self,ev)}),this._eventHandler=[],this},Hammer.Instance.prototype={on:function(gesture,handler){var gestures=gesture.split(" ");return Hammer.utils.each(gestures,function(gesture){this.element.addEventListener(gesture,handler,!1),this._eventHandler.push({gesture:gesture,handler:handler})},this),this},off:function(gesture,handler){var gestures=gesture.split(" ");return Hammer.utils.each(gestures,function(gesture){this.element.removeEventListener(gesture,handler,!1);var index=-1;Hammer.utils.each(this._eventHandler,function(eventHandler,i){-1===index&&eventHandler.gesture===gesture&&eventHandler.handler===handler&&(index=i)},this),index>-1&&this._eventHandler.splice(index,1)},this),this},trigger:function(gesture,eventData){eventData||(eventData={});var event=Hammer.DOCUMENT.createEvent("Event");event.initEvent(gesture,!0,!0),event.gesture=eventData;var element=this.element;return Hammer.utils.hasParent(eventData.target,element)&&(element=eventData.target),element.dispatchEvent(event),this},enable:function(state){return this.enabled=state,this},dispose:function(){return this.options.stop_browser_behavior&&Hammer.utils.startDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),Hammer.utils.each(this._eventHandler,function(eventHandler){this.element.removeEventListener(eventHandler.gesture,eventHandler.handler,!1)},this),this._eventHandler.length=0,Hammer.event.unbindDom(this.element,Hammer.EVENT_TYPES[Hammer.EVENT_START],this._eventStartHandler),this}};var last_move_event=null,enable_detect=!1,touch_triggered=!1;Hammer.event={bindDom:function(element,type,handler){var types=type.split(" ");Hammer.utils.each(types,function(type){element.addEventListener(type,handler,!1)})},unbindDom:function(element,type,handler){var types=type.split(" ");Hammer.utils.each(types,function(type){element.removeEventListener(type,handler,!1)})},onTouch:function(element,eventType,handler){var self=this,fn=function(ev){var sourceEventType=ev.type.toLowerCase();if(!sourceEventType.match(/mouse/)||!touch_triggered){sourceEventType.match(/touch/)||sourceEventType.match(/pointerdown/)||sourceEventType.match(/mouse/)&&1===ev.which?enable_detect=!0:sourceEventType.match(/mouse/)&&!ev.which&&(enable_detect=!1),sourceEventType.match(/touch|pointer/)&&(touch_triggered=!0);var count_touches=0;enable_detect&&(Hammer.HAS_POINTEREVENTS&&eventType!=Hammer.EVENT_END?count_touches=Hammer.PointerEvent.updatePointer(eventType,ev):sourceEventType.match(/touch/)?count_touches=ev.touches.length:touch_triggered||(count_touches=sourceEventType.match(/up/)?0:1),count_touches>0&&eventType==Hammer.EVENT_END?eventType=Hammer.EVENT_MOVE:count_touches||(eventType=Hammer.EVENT_END),(count_touches||null===last_move_event)&&(last_move_event=ev),handler.call(Hammer.detection,self.collectEventData(element,eventType,self.getTouchList(last_move_event,eventType),ev)),Hammer.HAS_POINTEREVENTS&&eventType==Hammer.EVENT_END&&(count_touches=Hammer.PointerEvent.updatePointer(eventType,ev))),count_touches||(last_move_event=null,enable_detect=!1,touch_triggered=!1,Hammer.PointerEvent.reset())}};return this.bindDom(element,Hammer.EVENT_TYPES[eventType],fn),fn},determineEventTypes:function(){var types;types=Hammer.HAS_POINTEREVENTS?Hammer.PointerEvent.getEvents():Hammer.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],Hammer.EVENT_TYPES[Hammer.EVENT_START]=types[0],Hammer.EVENT_TYPES[Hammer.EVENT_MOVE]=types[1],Hammer.EVENT_TYPES[Hammer.EVENT_END]=types[2]},getTouchList:function(ev){return Hammer.HAS_POINTEREVENTS?Hammer.PointerEvent.getTouchList():ev.touches?ev.touches:(ev.identifier=1,[ev])},collectEventData:function(element,eventType,touches,ev){var pointerType=Hammer.POINTER_TOUCH;return(ev.type.match(/mouse/)||Hammer.PointerEvent.matchType(Hammer.POINTER_MOUSE,ev))&&(pointerType=Hammer.POINTER_MOUSE),{center:Hammer.utils.getCenter(touches),timeStamp:(new Date).getTime(),target:ev.target,touches:touches,eventType:eventType,pointerType:pointerType,srcEvent:ev,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return Hammer.detection.stopDetect()}}}},Hammer.PointerEvent={pointers:{},getTouchList:function(){var self=this,touchlist=[];return Hammer.utils.each(self.pointers,function(pointer){touchlist.push(pointer)}),touchlist},updatePointer:function(type,pointerEvent){return type==Hammer.EVENT_END?delete this.pointers[pointerEvent.pointerId]:(pointerEvent.identifier=pointerEvent.pointerId,this.pointers[pointerEvent.pointerId]=pointerEvent),Object.keys(this.pointers).length},matchType:function(pointerType,ev){if(!ev.pointerType)return!1;var pt=ev.pointerType,types={};return types[Hammer.POINTER_MOUSE]=pt===ev.MSPOINTER_TYPE_MOUSE||pt===Hammer.POINTER_MOUSE,types[Hammer.POINTER_TOUCH]=pt===ev.MSPOINTER_TYPE_TOUCH||pt===Hammer.POINTER_TOUCH,types[Hammer.POINTER_PEN]=pt===ev.MSPOINTER_TYPE_PEN||pt===Hammer.POINTER_PEN,types[pointerType]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},Hammer.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(inst,eventData){this.current||(this.stopped=!1,this.current={inst:inst,startEvent:Hammer.utils.extend({},eventData),lastEvent:!1,lastVEvent:!1,velocity:!1,name:""},this.detect(eventData))},detect:function(eventData){if(this.current&&!this.stopped){eventData=this.extendEventData(eventData);var inst_options=this.current.inst.options;return Hammer.utils.each(this.gestures,function(gesture){return this.stopped||inst_options[gesture.name]===!1||gesture.handler.call(gesture,eventData,this.current.inst)!==!1?void 0:(this.stopDetect(),!1)},this),this.current&&(this.current.lastEvent=eventData),eventData.eventType==Hammer.EVENT_END&&!eventData.touches.length-1&&this.stopDetect(),eventData}},stopDetect:function(){this.previous=Hammer.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(ev){var startEv=this.current.startEvent,lastVEv=this.current.lastVEvent;!startEv||ev.touches.length==startEv.touches.length&&ev.touches!==startEv.touches||(startEv.touches=[],Hammer.utils.each(ev.touches,function(touch){startEv.touches.push(Hammer.utils.extend({},touch))}));var interimAngle,interimDirection,delta_time=ev.timeStamp-startEv.timeStamp,delta_x=ev.center.pageX-startEv.center.pageX,delta_y=ev.center.pageY-startEv.center.pageY,velocity=this.current.velocity;return lastVEv!==!1&&ev.timeStamp-lastVEv.timeStamp>Hammer.UPDATE_VELOCITY_INTERVAL?(velocity=Hammer.utils.getVelocity(ev.timeStamp-lastVEv.timeStamp,ev.center.pageX-lastVEv.center.pageX,ev.center.pageY-lastVEv.center.pageY),this.current.lastVEvent=ev,velocity.x>0&&velocity.y>0&&(this.current.velocity=velocity)):this.current.velocity===!1&&(velocity=Hammer.utils.getVelocity(delta_time,delta_x,delta_y),this.current.velocity=velocity,this.current.lastVEvent=ev),"end"===ev.eventType?(interimAngle=this.current.lastEvent&&this.current.lastEvent.interimAngle,interimDirection=this.current.lastEvent&&this.current.lastEvent.interimDirection):(interimAngle=this.current.lastEvent&&Hammer.utils.getAngle(this.current.lastEvent.center,ev.center),interimDirection=this.current.lastEvent&&Hammer.utils.getDirection(this.current.lastEvent.center,ev.center)),Hammer.utils.extend(ev,{deltaTime:delta_time,deltaX:delta_x,deltaY:delta_y,velocityX:velocity.x,velocityY:velocity.y,distance:Hammer.utils.getDistance(startEv.center,ev.center),angle:Hammer.utils.getAngle(startEv.center,ev.center),interimAngle:interimAngle,direction:Hammer.utils.getDirection(startEv.center,ev.center),interimDirection:interimDirection,scale:Hammer.utils.getScale(startEv.touches,ev.touches),rotation:Hammer.utils.getRotation(startEv.touches,ev.touches),startEvent:startEv}),ev},register:function(gesture){var options=gesture.defaults||{};return options[gesture.name]===undefined&&(options[gesture.name]=!0),Hammer.utils.extend(Hammer.defaults,options,!0),gesture.index=gesture.index||1e3,this.gestures.push(gesture),this.gestures.sort(function(a,b){return a.index<b.index?-1:a.index>b.index?1:0}),this.gestures}},Hammer.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,correct_for_drag_min_distance:!0,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,drag_lock_min_distance:25},triggered:!1,handler:function(ev,inst){if(Hammer.detection.current.name!=this.name&&this.triggered)return inst.trigger(this.name+"end",ev),void(this.triggered=!1);if(!(inst.options.drag_max_touches>0&&ev.touches.length>inst.options.drag_max_touches))switch(ev.eventType){case Hammer.EVENT_START:this.triggered=!1;break;case Hammer.EVENT_MOVE:if(ev.distance<inst.options.drag_min_distance&&Hammer.detection.current.name!=this.name)return;if(Hammer.detection.current.name!=this.name&&(Hammer.detection.current.name=this.name,inst.options.correct_for_drag_min_distance&&ev.distance>0)){var factor=Math.abs(inst.options.drag_min_distance/ev.distance);Hammer.detection.current.startEvent.center.pageX+=ev.deltaX*factor,Hammer.detection.current.startEvent.center.pageY+=ev.deltaY*factor,ev=Hammer.detection.extendEventData(ev)}(Hammer.detection.current.lastEvent.drag_locked_to_axis||inst.options.drag_lock_to_axis&&inst.options.drag_lock_min_distance<=ev.distance)&&(ev.drag_locked_to_axis=!0);var last_direction=Hammer.detection.current.lastEvent.direction;ev.drag_locked_to_axis&&last_direction!==ev.direction&&(ev.direction=Hammer.utils.isVertical(last_direction)?ev.deltaY<0?Hammer.DIRECTION_UP:Hammer.DIRECTION_DOWN:ev.deltaX<0?Hammer.DIRECTION_LEFT:Hammer.DIRECTION_RIGHT),this.triggered||(inst.trigger(this.name+"start",ev),this.triggered=!0),inst.trigger(this.name,ev),inst.trigger(this.name+ev.direction,ev),(inst.options.drag_block_vertical&&Hammer.utils.isVertical(ev.direction)||inst.options.drag_block_horizontal&&!Hammer.utils.isVertical(ev.direction))&&ev.preventDefault();break;case Hammer.EVENT_END:this.triggered&&inst.trigger(this.name+"end",ev),this.triggered=!1}}},Hammer.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(ev,inst){switch(ev.eventType){case Hammer.EVENT_START:clearTimeout(this.timer),Hammer.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==Hammer.detection.current.name&&inst.trigger("hold",ev)},inst.options.hold_timeout);break;case Hammer.EVENT_MOVE:ev.distance>inst.options.hold_threshold&&clearTimeout(this.timer);break;case Hammer.EVENT_END:clearTimeout(this.timer)}}},Hammer.gestures.Release={name:"release",index:1/0,handler:function(ev,inst){ev.eventType==Hammer.EVENT_END&&inst.trigger(this.name,ev)}},Hammer.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_min_touches:1,swipe_max_touches:1,swipe_velocity:.7},handler:function(ev,inst){if(ev.eventType==Hammer.EVENT_END){if(inst.options.swipe_max_touches>0&&ev.touches.length<inst.options.swipe_min_touches&&ev.touches.length>inst.options.swipe_max_touches)return;(ev.velocityX>inst.options.swipe_velocity||ev.velocityY>inst.options.swipe_velocity)&&(inst.trigger(this.name,ev),inst.trigger(this.name+ev.direction,ev))}}},Hammer.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(ev,inst){if(ev.eventType!=Hammer.EVENT_MOVE||Hammer.detection.current.reachedTapMaxDistance){if(ev.eventType==Hammer.EVENT_END&&"touchcancel"!=ev.srcEvent.type){var prev=Hammer.detection.previous,did_doubletap=!1;if(Hammer.detection.current.reachedTapMaxDistance||ev.deltaTime>inst.options.tap_max_touchtime)return;prev&&"tap"==prev.name&&ev.timeStamp-prev.lastEvent.timeStamp<inst.options.doubletap_interval&&ev.distance<inst.options.doubletap_distance&&(inst.trigger("doubletap",ev),did_doubletap=!0),(!did_doubletap||inst.options.tap_always)&&(Hammer.detection.current.name="tap",inst.trigger(Hammer.detection.current.name,ev))}}else Hammer.detection.current.reachedTapMaxDistance=ev.distance>inst.options.tap_max_distance}},Hammer.gestures.Touch={name:"touch",index:-(1/0),defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(ev,inst){return inst.options.prevent_mouseevents&&ev.pointerType==Hammer.POINTER_MOUSE?void ev.stopDetect():(inst.options.prevent_default&&ev.preventDefault(),void(ev.eventType==Hammer.EVENT_START&&inst.trigger(this.name,ev)))}},Hammer.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(ev,inst){if(Hammer.detection.current.name!=this.name&&this.triggered)return inst.trigger(this.name+"end",ev),void(this.triggered=!1);if(!(ev.touches.length<2))switch(inst.options.transform_always_block&&ev.preventDefault(),ev.eventType){case Hammer.EVENT_START:this.triggered=!1;break;case Hammer.EVENT_MOVE:var scale_threshold=Math.abs(1-ev.scale),rotation_threshold=Math.abs(ev.rotation);if(scale_threshold<inst.options.transform_min_scale&&rotation_threshold<inst.options.transform_min_rotation)return;Hammer.detection.current.name=this.name,this.triggered||(inst.trigger(this.name+"start",ev),this.triggered=!0),inst.trigger(this.name,ev),rotation_threshold>inst.options.transform_min_rotation&&inst.trigger("rotate",ev),scale_threshold>inst.options.transform_min_scale&&(inst.trigger("pinch",ev),inst.trigger("pinch"+(ev.scale<1?"in":"out"),ev));break;case Hammer.EVENT_END:this.triggered&&inst.trigger(this.name+"end",ev),this.triggered=!1}}},"function"==typeof define&&define.amd?define(function(){return Hammer}):"object"==typeof module&&module.exports?module.exports=Hammer:window.Hammer=Hammer}(window)},{}],19:[function(require,module){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||0>n||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(er=arguments[1],er instanceof Error)throw er;throw TypeError('Uncaught, unspecified "error" event.')}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(len=arguments.length,args=new Array(len-1),i=1;len>i;i++)args[i-1]=arguments[i];handler.apply(this,args)}else if(isObject(handler)){for(len=arguments.length,args=new Array(len-1),i=1;len>i;i++)args[i-1]=arguments[i];for(listeners=handler.slice(),len=listeners.length,i=0;len>i;i++)listeners[i].apply(this,args)}return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned){var m;m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-->0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(0>position)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.listenerCount=function(emitter,type){var ret;return ret=emitter._events&&emitter._events[type]?isFunction(emitter._events[type])?1:emitter._events[type].length:0}},{}]},{},[13]);